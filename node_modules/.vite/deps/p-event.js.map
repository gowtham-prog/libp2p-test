{
  "version": 3,
  "sources": ["../../../../../node_modules/p-event/index.js"],
  "sourcesContent": ["import pTimeout from 'p-timeout';\n\nconst normalizeEmitter = emitter => {\n\tconst addListener = emitter.on || emitter.addListener || emitter.addEventListener;\n\tconst removeListener = emitter.off || emitter.removeListener || emitter.removeEventListener;\n\n\tif (!addListener || !removeListener) {\n\t\tthrow new TypeError('Emitter is not compatible');\n\t}\n\n\treturn {\n\t\taddListener: addListener.bind(emitter),\n\t\tremoveListener: removeListener.bind(emitter),\n\t};\n};\n\nexport function pEventMultiple(emitter, event, options) {\n\tlet cancel;\n\tconst returnValue = new Promise((resolve, reject) => {\n\t\toptions = {\n\t\t\trejectionEvents: ['error'],\n\t\t\tmultiArgs: false,\n\t\t\tresolveImmediately: false,\n\t\t\t...options,\n\t\t};\n\n\t\tif (!(options.count >= 0 && (options.count === Number.POSITIVE_INFINITY || Number.isInteger(options.count)))) {\n\t\t\tthrow new TypeError('The `count` option should be at least 0 or more');\n\t\t}\n\n\t\toptions.signal?.throwIfAborted();\n\n\t\t// Allow multiple events\n\t\tconst events = [event].flat();\n\n\t\tconst items = [];\n\t\tconst {addListener, removeListener} = normalizeEmitter(emitter);\n\n\t\tconst onItem = (...arguments_) => {\n\t\t\tconst value = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\t\t// eslint-disable-next-line unicorn/no-array-callback-reference\n\t\t\tif (options.filter && !options.filter(value)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\titems.push(value);\n\n\t\t\tif (options.count === items.length) {\n\t\t\t\tcancel();\n\t\t\t\tresolve(items);\n\t\t\t}\n\t\t};\n\n\t\tconst rejectHandler = error => {\n\t\t\tcancel();\n\t\t\treject(error);\n\t\t};\n\n\t\tcancel = () => {\n\t\t\tfor (const event of events) {\n\t\t\t\tremoveListener(event, onItem);\n\t\t\t}\n\n\t\t\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\t\t\tremoveListener(rejectionEvent, rejectHandler);\n\t\t\t}\n\t\t};\n\n\t\tfor (const event of events) {\n\t\t\taddListener(event, onItem);\n\t\t}\n\n\t\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\t\taddListener(rejectionEvent, rejectHandler);\n\t\t}\n\n\t\tif (options.signal) {\n\t\t\toptions.signal.addEventListener('abort', () => {\n\t\t\t\trejectHandler(options.signal.reason);\n\t\t\t}, {once: true});\n\t\t}\n\n\t\tif (options.resolveImmediately) {\n\t\t\tresolve(items);\n\t\t}\n\t});\n\n\treturnValue.cancel = cancel;\n\n\tif (typeof options.timeout === 'number') {\n\t\tconst timeout = pTimeout(returnValue, {milliseconds: options.timeout});\n\t\ttimeout.cancel = cancel;\n\t\treturn timeout;\n\t}\n\n\treturn returnValue;\n}\n\nexport function pEvent(emitter, event, options) {\n\tif (typeof options === 'function') {\n\t\toptions = {filter: options};\n\t}\n\n\toptions = {\n\t\t...options,\n\t\tcount: 1,\n\t\tresolveImmediately: false,\n\t};\n\n\tconst arrayPromise = pEventMultiple(emitter, event, options);\n\tconst promise = arrayPromise.then(array => array[0]);\n\tpromise.cancel = arrayPromise.cancel;\n\n\treturn promise;\n}\n\nexport function pEventIterator(emitter, event, options) {\n\tif (typeof options === 'function') {\n\t\toptions = {filter: options};\n\t}\n\n\t// Allow multiple events\n\tconst events = [event].flat();\n\n\toptions = {\n\t\trejectionEvents: ['error'],\n\t\tresolutionEvents: [],\n\t\tlimit: Number.POSITIVE_INFINITY,\n\t\tmultiArgs: false,\n\t\t...options,\n\t};\n\n\tconst {limit} = options;\n\tconst isValidLimit = limit >= 0 && (limit === Number.POSITIVE_INFINITY || Number.isInteger(limit));\n\tif (!isValidLimit) {\n\t\tthrow new TypeError('The `limit` option should be a non-negative integer or Infinity');\n\t}\n\n\toptions.signal?.throwIfAborted();\n\n\tif (limit === 0) {\n\t\t// Return an empty async iterator to avoid any further cost\n\t\treturn {\n\t\t\t[Symbol.asyncIterator]() {\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tasync next() {\n\t\t\t\treturn {\n\t\t\t\t\tdone: true,\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t};\n\t\t\t},\n\t\t};\n\t}\n\n\tconst {addListener, removeListener} = normalizeEmitter(emitter);\n\n\tlet isDone = false;\n\tlet error;\n\tlet hasPendingError = false;\n\tconst nextQueue = [];\n\tconst valueQueue = [];\n\tlet eventCount = 0;\n\tlet isLimitReached = false;\n\n\tconst valueHandler = (...arguments_) => {\n\t\teventCount++;\n\t\tisLimitReached = eventCount === limit;\n\n\t\tconst value = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\tif (nextQueue.length > 0) {\n\t\t\tconst {resolve} = nextQueue.shift();\n\n\t\t\tresolve({done: false, value});\n\n\t\t\tif (isLimitReached) {\n\t\t\t\tcancel();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvalueQueue.push(value);\n\n\t\tif (isLimitReached) {\n\t\t\tcancel();\n\t\t}\n\t};\n\n\tconst cancel = () => {\n\t\tisDone = true;\n\n\t\tfor (const event of events) {\n\t\t\tremoveListener(event, valueHandler);\n\t\t}\n\n\t\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\t\tremoveListener(rejectionEvent, rejectHandler);\n\t\t}\n\n\t\tfor (const resolutionEvent of options.resolutionEvents) {\n\t\t\tremoveListener(resolutionEvent, resolveHandler);\n\t\t}\n\n\t\twhile (nextQueue.length > 0) {\n\t\t\tconst {resolve} = nextQueue.shift();\n\t\t\tresolve({done: true, value: undefined});\n\t\t}\n\t};\n\n\tconst rejectHandler = (...arguments_) => {\n\t\terror = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\tif (nextQueue.length > 0) {\n\t\t\tconst {reject} = nextQueue.shift();\n\t\t\treject(error);\n\t\t} else {\n\t\t\thasPendingError = true;\n\t\t}\n\n\t\tcancel();\n\t};\n\n\tconst resolveHandler = (...arguments_) => {\n\t\tconst value = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\t// eslint-disable-next-line unicorn/no-array-callback-reference\n\t\tif (options.filter && !options.filter(value)) {\n\t\t\tcancel();\n\t\t\treturn;\n\t\t}\n\n\t\tif (nextQueue.length > 0) {\n\t\t\tconst {resolve} = nextQueue.shift();\n\t\t\tresolve({done: true, value});\n\t\t} else {\n\t\t\tvalueQueue.push(value);\n\t\t}\n\n\t\tcancel();\n\t};\n\n\tfor (const event of events) {\n\t\taddListener(event, valueHandler);\n\t}\n\n\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\taddListener(rejectionEvent, rejectHandler);\n\t}\n\n\tfor (const resolutionEvent of options.resolutionEvents) {\n\t\taddListener(resolutionEvent, resolveHandler);\n\t}\n\n\tif (options.signal) {\n\t\toptions.signal.addEventListener('abort', () => {\n\t\t\trejectHandler(options.signal.reason);\n\t\t}, {once: true});\n\t}\n\n\treturn {\n\t\t[Symbol.asyncIterator]() {\n\t\t\treturn this;\n\t\t},\n\t\tasync next() {\n\t\t\tif (valueQueue.length > 0) {\n\t\t\t\tconst value = valueQueue.shift();\n\t\t\t\treturn {\n\t\t\t\t\tdone: isDone && valueQueue.length === 0 && !isLimitReached,\n\t\t\t\t\tvalue,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (hasPendingError) {\n\t\t\t\thasPendingError = false;\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\tif (isDone) {\n\t\t\t\treturn {\n\t\t\t\t\tdone: true,\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tnextQueue.push({resolve, reject});\n\t\t\t});\n\t\t},\n\t\tasync return(value) {\n\t\t\tcancel();\n\t\t\treturn {\n\t\t\t\tdone: isDone,\n\t\t\t\tvalue,\n\t\t\t};\n\t\t},\n\t};\n}\n\nexport {TimeoutError} from 'p-timeout';\n"],
  "mappings": "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",
  "names": ["event"]
}
